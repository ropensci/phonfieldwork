---
title: "Phonetic fieldwork and experiments with the `phonfieldwork` package for R"
author: "G. Moroz"
date: "10/27/2020"
output:
  html_document:
bibliography: bibliography.bib
biblio-style: "apalike"
---

## Science craft

As a field linguist, I have spent a lot of time working in villages in the Caucasus, collecting audio from speakers of indigenous languages. The processing of such data involves a lot of time-consuming tasks, so during my field trips I created my own pipeline for data collection. I wrote a number of scripts using different programming languages for automatic renaming, merging, and preannotation of files, making backups, visualizing some data, etc. My method consisted of a combination of solutions developed on the fly to solve specific, independent tasks, without thinking of the future.

This became a problem when I wanted to pass on my knowledge to my students. Not all of them were familiar with all of the programming languages I used, some of the code had become outdated, and some code did not work properly on all operating systems.

The practical side of linguistic research is often neglected. Linguists rely on manual and makeshift solutions for working with data and simultaneously write similar scripts, reinventing the same wheel as part of the process. The few existing software programs are undercited: there are a lot of papers presenting data processed in R [@r], Praat [@boersma20], ELAN [@brugman04] or other software, which do not cite them. Methodologically oriented papers are valued mainly for their theoretical implications.

Recent years have seen increased attention to best practices in linguistic data management, for example through the introduction of [Cross-Linguistic Data Formats](https://cldf.clld.org/) [@forkel18]. I think the time is also ripe to pay more attention to what I like to call **science craft** -- improving the methods for creating linguistic data, and allowing future generations of linguists to benefit from our experience.

That is why I decided to create a toolkit for phonetic researchers in the form of an R package: it is written using one programming language, and easy to use for non-coders and people who are not familiar with R.

Below is an overview of its main functions.

## `phonfieldwork`

Most phonetic research consists of the following steps:

1. Formulate a research question. Think of what kind of data is necessary to answer this question, what is the appropriate amount of data, what kind of annotation you will do, what kind of statistical models and visualizations you will use, etc.
2. Create a list of stimuli.
3. Elicit the list of stimuli from speakers who signed an Informed Consent statement, agreeing to participate in the experiment and to be recorded on audio and/or video. Keep an eye on the recording settings: the sampling rate, resolution (bit), and number of channels should be the same across all recordings.
4. Annotate the collected data.
5. Extract the collected data.
6. Create visualizations and evaluate your statistical models.
7. Report your results.
8. Publish your data.

The phonfieldwork package is created for helping with items 3, 5, and 8, and partially 4. If you are interested in the whole pipeline please read the whole [Get started section](https://ropensci.github.io/phonfieldwork/articles/phonfieldwork.html) in the package documentation. Below I will introduce some specific features.

##  What can be done with `phonfieldwork`?

First let's load the package:

```{r}
library(phonfieldwork)
```


### Sound annotation formats

There was a goal to be able to convert multiple sound annotation formats into data.frame format, so you can find a whole bunch of functions that serve this purpose:

* file `.TextGrid` from Praat (just change the `system.file()` function to the path to the file); see also [`rPraat`](https://fu.ff.cuni.cz/praat/#rpraat-package-for-r) and [`textgRid`](https://github.com/patrickreidy/textgRid) packages
```{r}
textgrid_to_df(system.file("extdata", "test.TextGrid", package = "phonfieldwork"))
```

* file `.eaf` from ELAN  (just change the `system.file()` function to the path to the file); see also the [FRelan](https://github.com/langdoc/FRelan) package by Niko Partanen

```{r}
eaf_to_df(system.file("extdata", "test.eaf", package = "phonfieldwork"))
```

* file `.exb` from EXMARaLDA  (just change the `system.file()` function to the path to the file)
```{r}
exb_to_df(system.file("extdata", "test.exb", package = "phonfieldwork"))
```

* subtitles file `.srt` (just change the `system.file()` function to the path to the file)

```{r}
srt_to_df(system.file("extdata", "test.srt", package = "phonfieldwork"))
```

* file `.txt` from Audacity

```{r}
audacity_to_df(system.file("extdata", "test_audacity.txt", package = "phonfieldwork"))
```

There is also an option to work with `.flextext` files from FLEx, but since this is not relevant for phonetics, I will skip this part.

### Sound visualization

Sound visualization is a common task that could be solved via different programs and R packages, but it can also be done with `phonfieldwork`:

```{r}
file <- system.file("extdata", "test.wav", package = "phonfieldwork")
draw_sound(file)
```

A feature specific to `phonfieldwork`, is that it is possible to zoom in to some part of the sound with a spectrogram (time in the `zoom` argument is represented in seconds):

```{r}
draw_sound(file, zoom = c(0.2, 0.4))
```

It is also possible to visualize any sound annotation format that was converted to dataframe in the previous section:

```{r}
our_textgrid <- system.file("extdata", "test.TextGrid", package = "phonfieldwork")
draw_sound(file, 
           annotation = textgrid_to_df(our_textgrid))
```

### Sound viewer

If you have folders with small sound chunks and their visualisations it is possible to create a sound viewer like [this](https://ropensci.github.io/phonfieldwork/additional/stimuli_viewer.html). This is done using the `create_viewer()` function:

```{r, eval = FALSE}
create_viewer(audio_dir = ".../sounds/", # path to folder with sounds
              picture_dir = ".../pictures/", # path to folder with pictures
              table = df, # dataframe with additional information
              output_dir = "...", # where to store the result?
              output_file = "...") # how to name the result file?
```

If you are familiar with my package `lingtypology` [@moroz17] for interactive linguistic map generation and API for typological databases, there is good news for you: it is possible to connect the two pacakages, creating an interactive map that shares the same hear and view buttons. Here is [an example](https://ropensci.github.io/phonfieldwork/additional/stimuli_viewer2.html).

I really hope that this format will become a new tool for searching, analyzing and sharing phonetic data. However, there is always a risk that this tool can be misused, so please read the [text about Ethical Research with phonfieldwork](https://ropensci.github.io/phonfieldwork/articles/ethical_research_with_phonfieldwork.html).

## Acknowledgements

I would like to thank

* my rOpenSci reviewers Jonathan Keane and Niko Partanen for their interesting comments and ideas;
* Melina Vidoni for being the package review editor;
* participants of seminars at the School of linguistics and Linguistic Convergence Laboratory at HSE, Moscow, where I first presented this package;
* my friends Neige Rochant and Samira Verhees for sharing their data and problems with me, which has made `phonfieldwork` better.

## Announcement

Dear all,

Itâ€™s my pleasure to announce a new stable release of phonfieldwork v.0.0.10 package for R that just passed rOpenSci review. The main goal of this package is to provide a huge variety of tools that can be used by phonetic researchers in the field and in laboratories. The package helps to collect, annotate and convert different sound annotation formats to tables. It is also possible to create sound viewers (like [this](https://ropensci.github.io/phonfieldwork/additional/stimuli_viewer.html)), which can be a handy tool for data analysis and data sharing process in phonetics. The process of work with this package is documented [here](https://ropensci.github.io/phonfieldwork/), but I would be happy to answer any of your questions via github issues or mail.

George Moroz,
Linguistic convergence laboratory, HSE
